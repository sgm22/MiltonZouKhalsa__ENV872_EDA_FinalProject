---
output: 
  pdf_document:
    keep_tex: yes
    fig_caption: yes
    number_sections: yes
geometry: margin=2.54cm
title: "Tracking COVID-19 Cases Across Different Geographic Neighborhoods in New York State"
subtitle: "Web address for GitHub repository"
author: "SMiltonDZouGKhalsa"
date: "2022-11-22"
fontsize: 12pt
mainfont: Times New Roman
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

\newpage
\tableofcontents 
\newpage
\listoftables 
\newpage
\listoffigures 
\newpage

## Set-up Data Set

```{r, message=FALSE}

#Set working directory


#Load packages

library(rvest)
library(tidyverse)
library(ggplot2)
library (lubridate)
library (dplyr)
library(sf)
library (leaflet)
library(mapview)
library(AER)


#Set theme

my_theme <- theme_bw(base_size = 12) + 
  theme(axis.text = element_text(color = "black"), 
      legend.position = "top", legend.justification = "center") +
  theme(plot.title = element_text(hjust = 0.5))
theme_set(my_theme)

```


## Import and Merge Data Sets

Important things to note: (delete later)

-There are 62 counties in New York State.

```{r, echo = FALSE}

#Import NY State county level COVID data (March 1, 2020 to November 22, 2022) from NY Health.

ny_covid_dat <- read.csv("./Data/Raw_Data/NY_COVID_County_Level.csv")

ny_covid_dat #View Data

#Import NY population data (2022)

ny_pop_dat <- read.csv("./Data/Raw_Data/NY_County_Level_Population_Data.csv",stringsAsFactors = TRUE)

ny_pop_dat

#Taken from https://www.census.gov/library/stories/state-by-state/new-york-population-change-between-census-decade.html

#Merge data sets

combined_dat_ny_covid_pop <- ny_pop_dat %>% 
  left_join(ny_covid_dat, by = "County")

```


### Explore Data

```{r}

head(combined_dat_ny_covid_pop)
summary(combined_dat_ny_covid_pop) #View Data
dim(combined_dat_ny_covid_pop)


## Add column for to classify counties into settlement types

combined_dat_ny_covid_pop <- combined_dat_ny_covid_pop %>%
  mutate(settlement_type = case_when(pop2022<=10000 ~ 'Rural',
                                     10000<pop2022 & pop2022<50000 ~ 'Micropolitan',
                                     pop2022>= 50000 ~ 'Urban'))

#Export Processed data

getwd() #Check working directory

write.csv2(combined_dat_ny_covid_pop,"./Data/Processed_Data/Combined_NY_COVID_Pop.csv")
```

# Rationale and Research Questions

\newpage

###Rationale

Coronavirus disease (COVID-19) is an infectious disease caused by the severe acute respiratory
syndrome coronavirus 2 (SARS-CoV-2). The virus is primarily spread from person to person through respiratory droplets and as such, population density plays a role in the transmission of the virus. Since COVID-19 was declared a global pandemic in March 2020 by the World Health
Organization (WHO) in March 2020, there has been a resurgece in COVID-19 infections across the globe.


--> Information to be added on COVID in NY specifically


###Research Questions

1. what is the strength of the relationship between different settlement types and cumulative COVID-19 cases?
2. What is the association between population density and the number of COVID-19 tests conducted?
3. How well does absolute population and population density predict the cumulative number of positive COVID-19 cases? 

# Dataset Information

\newpage


# Exploratory Analysis 

\newpage

```{r}








# Read in counties shapefile into an sf dataframe, filtering for just NY counties

uscounty <- st_read('./Data/Spatial_Files/cb_2018_us_county_20m.shp') %>%
  filter(STATEFP == 36)



```

# Analysis

## Question 1: what is the relationship between different settlement types and the number of positive cumulative COVID-19 cases?

```{r}

summary (modelpoisson <- glm(sum_cumulative_no_of_positive ~ factor(settlement_type), family = poisson, data = combined_dat_ny_covid_pop))

par (mfrow = c(2,2))
plot(modelpoisson) #Check fit

modelpoisson$model$fitted <- predict(modelpoisson, type="response")
modelpoisson$model$fitted

# Plot

#ggplot(modelpoisson$model) +
#  geom_point(aes(combined_dat_ny_covid_pop$settlement_type,combined_dat_ny_covid_pop$sum_cumulative_no_of_positives)) +
#  geom_line(aes(combined_dat_ny_covid_pop$settlement_type,fitted))


```

## Question 2: How well does absolute population and population density predict the cumulative number of positive COVID-19 cases? 

```{r}



summary(model1 <- glm(sum_cumulative_no_of_positive ~ pop2022 + density_permilessquared , family = poisson, data = combined_dat_ny_covid_pop))

par (mfrow = c(2,2))
plot(model1)


dispersiontest(model1)

```


## Question 3: What is the association between absolute population and the number of COVID-19 tests conducted?

```{r}

ggplot(data = combined_dat_ny_covid_pop, aes(x=pop2022, y= density_permilessquared)) +
  geom_point() +
  geom_smooth(method=lm)


plot(combined_dat_ny_covid_pop$pop2022,combined_dat_ny_covid_pop$density_permilessquared, pch = 19)

abline(lm(combined_dat_ny_covid_pop$density_permilessquared ~ combined_dat_ny_covid_pop$pop2022), col = "red", lwd = 3)

text(paste("Correlation:", round(cor(combined_dat_ny_covid_pop$pop2022,combined_dat_ny_covid_pop$density_permilessquared), 2)), x = 95, y = 25)


```

\newpage

# Summary and Conclusions


\newpage

# References
<add references here if relevant, otherwise delete this section> 
